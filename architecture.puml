@startuml
!includeurl https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

' Force top-to-bottom layout for clarity
LAYOUT_TOP_DOWN()

' ===== CLEAN MONOCHROME STYLING =====
UpdateElementStyle("person", $bgColor="#1A1A1A", $fontColor="#FFFFFF", $borderColor="#000000", $borderThickness="2")
UpdateElementStyle("container", $bgColor="#EDEDED", $fontColor="#000000", $borderColor="#000000", $borderThickness="2")
UpdateElementStyle("database", $bgColor="#D9D9D9", $fontColor="#000000", $borderColor="#000000", $borderThickness="2")
UpdateElementStyle("external_system", $bgColor="#F8F8F8", $fontColor="#333333", $borderColor="#666666", $borderStyle="dashed", $borderThickness="1")

AddRelTag("async", $lineColor="#000000", $lineStyle="dashed")
AddRelTag("sync", $lineColor="#000000", $lineStyle="solid", $lineThickness="2")

skinparam {
    BackgroundColor #FFFFFF
    shadowing false
    RoundCorner 5
    Padding 10
    ArrowColor #000000
    ArrowThickness 2
}

' ===== TITLE =====
title LUMIQ - High-Level Architecture\nContainer Diagram

' ===== ACTORS (TOP LEVEL) =====
Person(student, "Student", "Books dorms & finds roommates")
Person(dormAdmin, "Dorm Admin", "Manages properties")

' ===== EXTERNAL SYSTEMS =====
System_Ext(groqAI, "GROQ AI API", "Llama 3.3 - Personality Analysis")

' ===== MAIN SYSTEM =====
System_Boundary(lumiq, "LUMIQ Platform") {
    
    ' Presentation Layer
    Container(webApp, "Web Application", "React 18 + TypeScript", "SPA for students and admins\nPort: 5173")
    
    ' Application Layer  
    Container(apiServer, "API Server", "Express.js + Node.js", "REST API with JWT auth & RBAC\nPort: 5001")
    
    ' Business Logic Layer
    Container(aiService, "AI Service", "Node.js", "Roommate matching & compatibility")
    Container(roomService, "Room Service", "Node.js", "Reservation management")
    Container(notifyService, "Notification Service", "Node.js", "Real-time notifications")
    
    ' Data Layer
    ContainerDb(mongodb, "MongoDB", "NoSQL Database", "11 collections:\nusers, dorms, rooms, bookings,\npersonalities, knocks, etc.")
}

' ===== RELATIONSHIPS =====

' User interactions
Rel_D(student, webApp, "Browse & Book", "HTTPS", $tags="sync")
Rel_D(dormAdmin, webApp, "Manage", "HTTPS", $tags="sync")

' API communication
Rel_D(webApp, apiServer, "API Requests", "REST/JSON + JWT", $tags="sync")

' Service layer
Rel_D(apiServer, aiService, "Match users", $tags="sync")
Rel_D(apiServer, roomService, "Manage rooms", $tags="sync")
Rel_D(apiServer, notifyService, "Send alerts", $tags="async")

' AI integration
Rel_R(aiService, groqAI, "Analyze personality", "HTTPS", $tags="sync")

' Database access
Rel_D(apiServer, mongodb, "CRUD Operations", "Mongoose ODM", $tags="sync")
Rel_D(aiService, mongodb, "Read/Write", $tags="sync")
Rel_D(roomService, mongodb, "Read/Write", $tags="sync")
Rel_D(notifyService, mongodb, "Read/Write", $tags="sync")

@enduml
